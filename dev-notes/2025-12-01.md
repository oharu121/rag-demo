## Premium UI/UX Upgrade

Comprehensive overhaul of the frontend UI/UX to create a polished, professional experience.

### Design System (globals.css)

Created a complete design system with:

```css
/* Premium color palette with CSS variables */
--primary-50 through --primary-900  /* Blue gradient scale */
--accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

/* Shadow system */
--shadow-sm through --shadow-2xl
--shadow-glow: 0 0 20px rgb(59 130 246 / 0.3);

/* Smooth transitions */
--transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
--transition-normal: 200ms cubic-bezier(0.4, 0, 0.2, 1);
--transition-bounce: 500ms cubic-bezier(0.68, -0.55, 0.265, 1.55);
```

#### Custom Animations Added

| Animation | Purpose |
|-----------|---------|
| `fadeIn` / `fadeInUp` / `fadeInDown` | Element entrance |
| `slideInRight` | Drawer entrance |
| `scaleIn` | Modal/popup appearance |
| `shimmer` | Loading skeleton effect |
| `pulse-glow` | Attention indicator |
| `float` | Subtle movement |
| `typing-cursor` | Chat streaming indicator |

#### Global Button Cursor Fix

```css
/* All interactive elements now have proper cursor */
button,
[role="button"],
input[type="submit"],
input[type="button"],
input[type="reset"],
.cursor-pointer {
  cursor: pointer;
}

button:disabled,
[role="button"]:disabled,
input:disabled {
  cursor: not-allowed;
}
```

#### Utility Classes Added

```css
.glass          /* Glass morphism: blur + translucency */
.glass-dark     /* Dark glass morphism */
.gradient-text  /* Gradient text effect */
.btn-primary    /* Premium button with gradient + shadow */
.btn-secondary  /* Secondary button style */
.input-premium  /* Styled input with focus glow */
.card           /* Card with shadow + border */
.badge-success/warning/error/info  /* Status badges */
```

### Component Upgrades

| Component | Changes |
|-----------|---------|
| **ChatInterface** | Gradient background (`from-slate-50 via-white to-blue-50/30`), glass morphism header, wider container (`max-w-4xl`), suggested prompts on welcome screen |
| **ChatInput** | Floating container with focus border glow, animated send button (scale on hover/active), keyboard hints with `<kbd>` styling |
| **MessageBubble** | Gradient user bubbles with drop shadow, AI avatar badge, source section with link icon, typing cursor animation |
| **DocumentDrawer** | Backdrop blur (`backdrop-blur-sm`), slide-in animation, improved header with subtitle, gradient rebuild button |
| **DocumentList** | Staggered entry animation, hover effects with shadow, gradient status badges with icons, reveal-on-hover delete button |
| **DocumentUpload** | Decorative corner elements, scale animation on drag (`scale-[1.02]`), glow during upload, clearer visual hierarchy |
| **SourceCitation** | Gradient badge with border, dark tooltip with code preview styling, smooth transitions |
| **LoadingSpinner** | Cleaner styling with proper border colors |
| **ServerStartingOverlay** | Dual-ring loader (counter-rotating), gradient background, glow effects, hint pill with icon |

### Micro-Interactions Added

1. **Button hover/active states:**
   - Scale transform (`hover:scale-105`, `active:scale-95`)
   - Shadow elevation changes
   - Color transitions

2. **Focus states:**
   - Ring glow effect (`focus:ring-2 focus:ring-blue-500/20`)
   - Border color change

3. **List items:**
   - Staggered fade-in (`animationDelay: ${index * 50}ms`)
   - Group hover effects (child elements react to parent hover)

4. **Transitions:**
   - All interactive elements use `transition-all duration-200`
   - Smooth color, shadow, and transform changes

### Before/After Comparison

| Aspect | Before | After |
|--------|--------|-------|
| Background | Plain white | Subtle gradient |
| Header | Basic border | Glass morphism + shadow |
| Buttons | Flat colors | Gradients + shadows + transforms |
| Input | Basic border | Floating container + focus glow |
| Messages | Simple rounded | Gradient + shadow + avatar |
| Animations | Minimal | Entrance + hover + loading |
| Scrollbar | Basic gray | Gradient thumb |

### Key UX Improvements

1. **Visual feedback everywhere** - Every click, hover, focus has clear response
2. **Depth hierarchy** - Shadows and gradients create visual layers
3. **Motion design** - Animations guide attention, provide feedback
4. **Accessibility maintained** - Focus states, aria labels, screen reader support

---

## Bug Fix: Double Focus Ring on Chat Input

### The Problem

When focusing the chat input textarea, two blue rings appeared:
1. The outer container border (intentional - turns blue on focus)
2. An inner rectangle around the textarea itself (unintentional)

This created a visual "double border" effect that looked broken.

### Root Cause

In `globals.css`, we had added a global focus-visible rule for premium focus states:

```css
/* Premium focus states */
*:focus-visible {
  outline: 2px solid var(--primary-500);
  outline-offset: 2px;
}
```

This `*:focus-visible` selector applies to **all elements**, including the textarea inside the chat input. Even though we had `outline-none` and `focus-visible:outline-none` on the textarea's Tailwind classes, the global CSS rule had higher specificity due to how CSS cascades work.

### Why Tailwind Classes Didn't Override

Tailwind's utility classes like `outline-none` generate:
```css
.outline-none { outline: 2px solid transparent; }
```

But our global rule `*:focus-visible` is applied at render time and can override depending on cascade order and specificity. The browser was applying both styles, with the global one winning.

### The Fix

Added a specific override in `globals.css` for form inputs that typically have custom focus handling via their parent container:

```css
/* Disable focus ring on elements that have custom focus handling via parent */
textarea:focus-visible,
input[type="text"]:focus-visible {
  outline: none;
}
```

This explicitly removes the outline for textareas and text inputs, since they commonly use a parent container pattern for focus indication (like our chat input box that shows focus via border color change on the wrapper div).

### Alternative Approaches Considered

1. **Removing the global `*:focus-visible` rule** - Would break focus states on buttons and other elements
2. **Using `!important` in Tailwind** - Anti-pattern, makes debugging harder
3. **More specific Tailwind classes** - Tried `focus:outline-none focus-visible:outline-none`, didn't fully override

### Lesson Learned

When adding global CSS rules with universal selectors (`*`), be careful about unintended effects on form elements. Form inputs often need special handling because:
- They have native browser focus styles
- They're frequently wrapped in containers that handle focus visually
- CSS specificity can be tricky with pseudo-classes like `:focus-visible`

A good pattern: Define global focus styles, then explicitly opt-out specific elements that have custom focus handling.

---

## UX Enhancement: Auto-Focus Chat Input

### The Change

Added auto-focus behavior to the chat input textarea so users can start typing immediately when visiting the page.

### Implementation

```typescript
// ChatInput.tsx
// Auto-focus on mount
useEffect(() => {
  if (!disabled && textareaRef.current) {
    textareaRef.current.focus();
  }
}, [disabled]);
```

### Why `disabled` in the Dependency Array

The `disabled` prop changes during the app lifecycle:
1. **Initial load**: `disabled=true` (server not ready during cold start)
2. **Server ready**: `disabled=false` (user can type)

By including `disabled` in the dependency array, the textarea automatically focuses when:
- The page first loads (if server is already ready)
- The server becomes ready after cold start (overlay disappears, input becomes enabled)

This ensures users don't have to manually click the input after waiting for the server to start.

### UX Benefit

Standard chat app behavior - users expect to be able to type immediately without clicking. Reduces friction, especially important after a potentially long cold start wait.

---

## Document Discoverability UX Improvement

### The Problem

Users visiting the app for a recruiter demo faced discoverability issues:
1. Pre-loaded sample documents weren't immediately visible
2. Users might think they need to upload documents first
3. The "ドキュメント管理" button was subtle and easy to miss
4. No clear indication of what documents were available to query

### Solution Overview

Implemented a multi-layered approach to make documents and capabilities immediately obvious:

1. **Enhanced Header Button** - Badge with document count + pulse animation
2. **Document Preview Chips** - Clickable document names on welcome screen
3. **One-Time Onboarding Tooltip** - Guided callout with backdrop
4. **Conditional Suggested Prompts** - Context-aware example questions

### Implementation Details

#### 1. OnboardingTooltip Component (New)

```typescript
// OnboardingTooltip.tsx
const STORAGE_KEY = "rag-demo-onboarding-seen";

export function OnboardingTooltip({ documentCount, onDismiss }) {
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const hasSeen = localStorage.getItem(STORAGE_KEY);
    if (!hasSeen && documentCount > 0) {
      const timer = setTimeout(() => setIsVisible(true), 500);
      return () => clearTimeout(timer);
    }
  }, [documentCount]);

  const handleDismiss = () => {
    localStorage.setItem(STORAGE_KEY, "true");
    setIsVisible(false);
    onDismiss();
  };
  // ... renders backdrop + tooltip pointing to document button
}
```

Features:
- Semi-transparent backdrop (`bg-black/30`)
- Positioned near document button with arrow pointer
- Shows document count dynamically
- Dismisses on click, stores in localStorage
- Only appears after server is ready (not during cold start)

#### 2. Header Button Enhancement

```tsx
<button className={`... ${showOnboarding ? "animate-pulse-glow" : ""}`}>
  <span>{UI_TEXT.openDocuments}</span>
  {totalDocuments > 0 && (
    <span className="ml-1 px-2 py-0.5 text-xs font-semibold bg-blue-100 text-blue-700 rounded-full">
      {totalDocuments}
    </span>
  )}
</button>
```

- Count badge shows total documents (sample + uploaded)
- Pulse glow animation draws attention on first visit
- Animation stops after onboarding is dismissed

#### 3. Document Preview on Welcome Screen

```tsx
{totalDocuments > 0 ? (
  <div className="mt-6 mb-8">
    <p className="text-gray-500 mb-4">{UI_TEXT.welcomeWithDocs}</p>

    {/* Document chips */}
    <div className="flex flex-wrap justify-center gap-2 max-w-lg mx-auto">
      {allDocuments.slice(0, 5).map((doc, i) => (
        <button
          key={doc.id}
          onClick={() => setIsDrawerOpen(true)}
          className="group flex items-center gap-2 px-3 py-2 bg-white border..."
          style={{ animationDelay: `${i * 50}ms` }}
        >
          <div className="w-6 h-6 rounded-lg bg-linear-to-br from-blue-100...">
            <DocumentIcon />
          </div>
          <span className="text-sm truncate max-w-[120px]">
            {doc.filename.replace(/\.txt$/, "")}
          </span>
        </button>
      ))}
    </div>

    <button onClick={() => setIsDrawerOpen(true)}>
      {UI_TEXT.manageDocuments} →
    </button>
  </div>
) : (
  <p>右上のボタンからドキュメントを追加してください。</p>
)}
```

- Shows up to 5 document chips with staggered animation
- Clicking any chip opens the document drawer
- "+N more" link if more than 5 documents
- "Manage documents" link below

#### 4. Conditional Suggested Prompts

```typescript
const suggestedPrompts = hasSampleDocs
  ? [
      "会社の休暇制度について教えて",
      "リモートワークのポリシーは?",
      "経費精算の方法は?",
    ]
  : [
      UI_TEXT.genericPrompt1,  // "この文書の要約を教えて"
      UI_TEXT.genericPrompt2,  // "主なポイントは何ですか？"
      UI_TEXT.genericPrompt3,  // "重要な情報をリストアップして"
    ];
```

- Sample-specific prompts when sample documents are loaded
- Generic prompts when user uploads their own documents
- Prompts hidden entirely when no documents exist

#### 5. Architecture Change: Lifted useDocuments Hook

```typescript
// ChatInterface.tsx
export function ChatInterface() {
  const documentsHook = useDocuments();
  const { sampleDocuments, uploadedDocuments } = documentsHook;

  // ... use documents for preview, count badge, etc.

  return (
    <>
      <DocumentDrawer
        isOpen={isDrawerOpen}
        onClose={() => setIsDrawerOpen(false)}
        documentsHook={documentsHook}  // Pass down to avoid duplicate fetch
      />
    </>
  );
}

// DocumentDrawer.tsx
interface DocumentDrawerProps {
  isOpen: boolean;
  onClose: () => void;
  documentsHook?: ReturnType<typeof useDocuments>;
}

export function DocumentDrawer({ isOpen, onClose, documentsHook }) {
  const internalHook = useDocuments();
  const { sampleDocuments, ... } = documentsHook || internalHook;
  // ...
}
```

- `useDocuments()` now called in parent (`ChatInterface`)
- Passed to `DocumentDrawer` as optional prop
- Avoids duplicate API calls and ensures consistent state

### New UI Text Constants

```typescript
// constants.ts
// Onboarding
onboardingMessage: "すぐに質問を始められます。自分のドキュメントをアップロードすることもできます。",
onboardingDismiss: "OK",
manageDocuments: "ドキュメントを管理",

// Welcome screen
welcomeWithDocs: "以下のドキュメントについて質問できます",

// Generic prompts (for user-uploaded documents)
genericPrompt1: "この文書の要約を教えて",
genericPrompt2: "主なポイントは何ですか？",
genericPrompt3: "重要な情報をリストアップして",
```

### Files Modified

| File | Changes |
|------|---------|
| `OnboardingTooltip.tsx` | New component - tooltip with backdrop |
| `ChatInterface.tsx` | Lifted useDocuments, added document preview, conditional prompts, onboarding |
| `DocumentDrawer.tsx` | Accepts optional documentsHook prop |
| `constants.ts` | New UI text strings |

### UX Flow for Recruiters

1. **Page loads** → Server starting overlay (if cold start)
2. **Server ready** → Onboarding tooltip appears with backdrop
3. **Welcome screen** → Shows document chips with names
4. **Header button** → Pulses with count badge `(3)`
5. **Click "OK"** → Tooltip dismissed, stored in localStorage
6. **Return visits** → No tooltip, just badge + document preview