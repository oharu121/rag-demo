# Development Notes - 2025-12-17

## Feature: DatasetSelector UX Improvements

### Overview
Continued work on the evaluation panel feature. Today focused on improving the DatasetSelector UX and fixing the document list to properly reflect dataset changes.

### Branch
`feature/evaluation-panel`

---

## Changes Made

### 1. DatasetSelector Redesign

**File: `frontend/app/components/DatasetSelector.tsx`**

Completely redesigned the component to be more educational and user-friendly:

#### Removed Hidden Strategy Section
- Removed collapsible "詳細設定" - strategy is now always visible
- Both dataset and strategy are equally prominent

#### Strategy Cards with Plain-Language Descriptions
Each strategy now shows:
1. Technical name (標準チャンク, 大きめチャンク, 親子チャンク)
2. What it does (plain Japanese explanation)
3. Pros/cons with ✓ and △ symbols

```typescript
const STRATEGY_INFO = {
  standard: {
    name: "標準チャンク",
    description: "文書を均等に分割。基本的な検索に最適",
    pros: "高速",
    cons: "文脈途切れ",
  },
  large: {
    name: "大きめチャンク",
    description: "大きめに分割し重複を持たせる。長い説明文向け",
    pros: "文脈を保持",
    cons: "精度低下の場合",
  },
  parent_child: {
    name: "親子チャンク",
    description: "細かく分割して検索し、周辺文脈も取得",
    pros: "精度と文脈",
    cons: "少し遅い",
  },
};
```

#### Sample Filenames Under Dataset Cards
Added preview of actual filenames to show the difference:
- 元データ: `就業規則.md, 通勤手当規程.md, 休暇規程.md ...`
- 最適化済み: `就業規則_正社員.md, 就業規則_パート.md, 通勤手当規程_アルバイト.md ...`

This visually demonstrates WHY optimized data is better - users see the employee-type split.

---

### 2. Document List Updates on Dataset Switch

**Problem:** When toggling between datasets, the document drawer count and chips bar didn't update.

**Root Cause:** Frontend's `fetchDocuments()` didn't pass `document_set` parameter to backend.

**Solution:** 4-file fix to pass documentSet through the stack:

| File | Change |
|------|--------|
| `backend/app/routers/documents.py` | Added `document_set` query parameter |
| `frontend/lib/api.ts` | `fetchDocuments(documentSet)` passes param to URL |
| `frontend/hooks/useDocuments.ts` | Accepts `documentSet`, refetches on change |
| `frontend/app/components/ChatInterface.tsx` | Passes `documentSet` state to hook |

**Result:** Document list now shows correct files per dataset:
- Original: 6 files (general regulations)
- Optimized: 18 files (split by employee type)

---

## Architecture Discussion

### State Management
Discussed whether to use Zustand - decided **not necessary** for this demo:
- Current state is simple and manageable
- No need for complex shared state across unrelated components
- React's built-in state + prop drilling is sufficient

### Backend Sync
Clarified that **no sync mechanism is needed**:
- Backend is stateless per request
- Each chat request includes `document_set` + `strategy` parameters
- Backend queries the correct ChromaDB collection based on request params
- No global "current selection" state on backend

### Multi-User Sessions
Confirmed **not needed**:
- No shared mutable state between users
- Each request is independent
- Two users can query different datasets simultaneously without conflict

---

## Files Modified Today

| File | Changes |
|------|---------|
| `frontend/app/components/DatasetSelector.tsx` | Complete redesign - visible strategy, descriptive labels, sample files |
| `backend/app/routers/documents.py` | Added `document_set` query param to list endpoint |
| `frontend/lib/api.ts` | `fetchDocuments()` accepts documentSet param |
| `frontend/hooks/useDocuments.ts` | Accepts documentSet, refetches on change |
| `frontend/app/components/ChatInterface.tsx` | Passes documentSet to useDocuments hook |

---

## Key Insights

1. **Keep technical terms, explain trade-offs** - Users learn vocabulary while understanding implications
2. **Show concrete examples** - Sample filenames make abstract "optimization" tangible
3. **Stateless > Stateful** - Per-request parameters are simpler than session management
4. **Don't over-engineer** - Simple prop drilling works fine for demo-scale apps
