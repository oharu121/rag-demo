# Dev Notes - 2025-12-25

## Fix: 精度テスト Button Not Collapsing Settings Panel After First Use

### Problem
When clicking the 精度テスト (accuracy test) button, the settings panel should collapse to give more screen space to the evaluation results. However, it only collapsed on the first click - subsequent clicks did not collapse the panel.

**Steps to reproduce:**
1. Open the app with the settings panel expanded
2. Click the 精度テスト button
3. Wait for the evaluation to complete
4. Expand the settings panel again
5. Click 精度テスト again

**Expected:** Panel collapses every time evaluation starts
**Actual:** Panel only collapsed on first click

### Root Cause

In `ChatInterface.tsx`, the `handleRunEvaluation` function only collapsed the panel when `hasUserInteracted` was `false`:

```typescript
// Before - only collapses on first interaction
const handleRunEvaluation = useCallback(async () => {
  if (isEvaluating || isLoading) return;

  // Auto-collapse after first test
  if (!hasUserInteracted) {
    setHasUserInteracted(true);
    setIsDatasetSelectorExpanded(false);
  }
  // ...
```

After the first evaluation run, `hasUserInteracted` becomes `true`, so the condition `if (!hasUserInteracted)` never passes again, and subsequent clicks on 精度テスト do not collapse the panel.

### Solution

Remove the conditional so that clicking 精度テスト always collapses the settings panel:

```typescript
// After - always collapses when running evaluation
const handleRunEvaluation = useCallback(async () => {
  if (isEvaluating || isLoading) return;

  // Always collapse when running evaluation
  setHasUserInteracted(true);
  setIsDatasetSelectorExpanded(false);
  // ...
```

### Files Changed

| File | Change |
|------|--------|
| `frontend/app/components/ChatInterface.tsx` | Removed `if (!hasUserInteracted)` conditional around collapse logic in `handleRunEvaluation` (lines 111-113) |

### Notes

The `handleSendMessage` function has similar logic (only collapse on first message), which is intentional - users may want to keep the panel open while chatting. However, for evaluation runs, collapsing makes sense every time since the evaluation results take up significant screen space.

---
